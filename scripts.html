<!doctype html>
<html lang="en" class="antialiased text-gray-900">
<!-- meta tags -->

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Akshay Ghate">
	<meta name="Description" content="Code snippets.">
	<meta name="Keywords" content="python,shell,backup,script">
	<meta name="robots" content="index, follow">
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="apple-touch-icon" href="faviconbg.png">
	<meta name="msapplication-TileImage" content="faviconbg.png">
	<link rel="icon" type="image/x-icon" href="favicon.ico">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="prism-tomorrow.css">
	<title>Scripts</title>
</head>

<body class="text-lg antialiased text-gray-700 bg-gray-100 font-body">
	<!-- header start -->
	<header>
		<!-- navigation large screen start -->
		<nav class="fixed z-20 invisible w-full bg-gray-100 border-b-2 shadow-md md:visible">
			<div class="max-w-6xl px-4 mx-auto sm:px-6 lg:px-8">
				<div class="flex items-center justify-between h-24">
					<div class="flex items-center">
						<div class="flex-shrink-0">
							<div class="pr-4">
								<a href="index.html"><img src="img/logo-transparent.svg" width="230" alt="Web-o-Reviews"></a>
							</div>
						</div>
						<a class="block px-3 py-2 mx-1 text-base font-medium transition duration-150 ease-in-out rounded-md hover:bg-gray-200 focus:outline-none"
							href="index.html">Home</a>
						<a class="block px-3 py-2 mx-1 text-base font-medium transition duration-150 ease-in-out rounded-md hover:bg-gray-200 focus:outline-none"
							href="design.html">Design</a>
						<a class="block px-3 py-2 mx-1 text-base font-medium transition duration-150 ease-in-out rounded-md hover:bg-gray-200 focus:outline-none"
							href="work.html">Work</a>
						<a class="block px-3 py-2 mx-1 text-base font-medium transition duration-150 ease-in-out rounded-md hover:bg-gray-200 focus:outline-none"
							href="about.html">About</a>
						<div class="flex justify-center">
							<div x-data="{ dropdownOpen: false }" class="relative ">
								<button @click="dropdownOpen = !dropdownOpen"
									class="relative z-10 flex items-center px-3 py-2 transition duration-200 ease-in bg-gray-100 rounded-md hover:bg-gray-200 hover:text-gray-100 focus:outline-none">
									<span class="text-base font-medium text-gray-700 ">More</span> <svg class="w-5 h-5 text-gray-800"
										xmlns="http://www.w3.org/2000/svg" viewbox="0 0 20 20" fill="currentColor">
										<path fill-rule="evenodd"
											d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
											clip-rule="evenodd" />
									</svg>
								</button>

								<div x-show="dropdownOpen" @click="dropdownOpen = false" class="fixed inset-0 z-10 w-full h-full"></div>

								<div x-show="dropdownOpen" class="absolute right-0 z-20 w-32 py-2 mt-2 bg-white rounded-md shadow-xl">
									<a href="scripts.html" class="block py-2 pl-6 text-base text-white capitalize bg-teal-500">
										Scripts
									</a>
									<a href="archive.html"
										class="block py-2 pl-6 text-base text-gray-700 capitalize hover:bg-teal-500 hover:text-white">
										Archive
									</a>
									<a href="license.html"
										class="block py-2 pl-6 text-base text-gray-700 capitalize hover:bg-teal-500 hover:text-white">
										License
									</a>
								</div>
							</div>
						</div>
					</div>
					<div class="flex content-end">
						<!-- contact button large screen -->
						<a class="inline-flex items-center px-4 py-3 text-base font-semibold leading-tight text-white rounded shadow-md bg-primary-dark md:invisible lg:visible hover:bg-primary"
							href="contact.html"><svg class="w-5 h-5 mr-2 text-white" xmlns="http://www.w3.org/2000/svg"
								viewbox="0 0 20 20" fill="currentColor">
								<path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
								<path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
							</svg><span>Contact</span></a>
						<!-- contact button medium screen -->
						<a class="flex items-center px-4 py-3 text-base font-semibold leading-tight text-white rounded shadow-md bg-primary-dark md:visible lg:invisible hover:bg-primary"
							href="contact.html"><svg class="w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 20 20"
								fill="currentColor">
								<path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
								<path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
							</svg></a>
					</div>
				</div>
			</div>
		</nav>
		<!-- navigation large screen end -->
		<!-- mobile navigation -->
		<nav class="fixed z-20 visible w-full bg-gray-100 border-b-2 shadow-md md:invisible">
			<div class="max-w-6xl px-4 mx-auto sm:px-6 lg:px-8">
				<div class="flex items-center justify-between h-24">
					<div class="flex items-center">
						<div class="flex-shrink-0">
							<div class="pr-4">
								<a href="index.html"><img src="img/logo-transparent.svg" width="230" alt="Web-o-Reviews"></a>
							</div>
						</div>
					</div>

					<div class="flex content-end">
						<div x-data="{ dropdownOpen: false }" class="relative ">
							<button @click="dropdownOpen = !dropdownOpen"
								class="relative z-10 block p-2 transition duration-200 ease-in bg-gray-300 rounded-md hover:bg-gray-200 hover:text-gray-100 focus:outline-none"
								aria-label="Menu">
								<svg class="w-5 h-5 text-gray-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24"
									stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
								</svg>
							</button>

							<div x-show="dropdownOpen" @click="dropdownOpen = false" class="fixed inset-0 z-10 w-full h-full"></div>

							<div x-show="dropdownOpen" class="absolute right-0 z-20 w-48 py-2 mt-2 bg-white rounded-md shadow-xl">
								<a href="index.html"
									class="block py-2 pl-6 text-lg text-gray-700 capitalize hover:bg-teal-500 hover:text-white"><svg
										class="inline-block w-5 h-5 mb-2 mr-2 " xmlns="http://www.w3.org/2000/svg" fill="none"
										viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
									</svg>
									Home
								</a>
								<a href="design.html"
									class="block py-2 pl-6 text-lg text-gray-700 capitalize hover:bg-teal-500 hover:text-white"><svg
										class="inline-block w-5 h-5 mb-1 mr-2 " xmlns="http://www.w3.org/2000/svg" fill="none"
										viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
									</svg>
									Design
								</a>
								<a href="work.html"
									class="block py-2 pl-6 text-lg text-gray-700 capitalize hover:bg-teal-500 hover:text-white"><svg
										class="inline-block w-5 h-5 mb-1 mr-2 " xmlns="http://www.w3.org/2000/svg" fill="none"
										viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
									</svg>
									Work
								</a>
								<a href="about.html"
									class="block py-2 pl-6 text-lg text-gray-700 capitalize hover:bg-teal-500 hover:text-white"><svg
										class="inline-block w-5 h-5 mb-2 mr-2 " xmlns="http://www.w3.org/2000/svg" fill="none"
										viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
									</svg>
									About
								</a>
								<a href="scripts.html"
									class="block py-2 pl-6 text-lg text-white capitalize bg-teal-500 hover:bg-gray-100 hover:text-gray-700"><svg
										class="inline-block w-5 h-5 mb-1 mr-2 " xmlns="http://www.w3.org/2000/svg" fill="none"
										viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
									</svg>
									Scripts
								</a>
								<a href="archive.html"
									class="block py-2 pl-6 text-lg text-gray-700 capitalize hover:bg-teal-500 hover:text-white"><svg
										class="inline-block w-5 h-5 mb-1 mr-2 " xmlns="http://www.w3.org/2000/svg" fill="none"
										viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
									</svg>
									Archive
								</a>
								<a href="license.html"
									class="block py-2 pl-6 text-lg text-gray-700 capitalize border-b-2 border-gray-300 shadow-sm hover:bg-teal-500 hover:text-white"><svg
										class="inline-block w-5 h-5 mb-2 mr-2 " xmlns="http://www.w3.org/2000/svg" fill="none"
										viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
									</svg>
									License
								</a>
								<a href="contact.html"
									class="block py-2 pl-6 text-lg text-gray-700 capitalize hover:bg-teal-500 hover:text-white"><svg
										class="inline-block w-5 h-5 mb-1 mr-2 " xmlns="http://www.w3.org/2000/svg" fill="none"
										viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
									</svg>
									Contact
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</nav>
		<!-- mobile navigation end -->
	</header>
	<!-- header end -->
	<!-- hero start -->
	<main class="pt-20">
		<div class="w-full h-auto min-h-full bg-teal-700">
			<div class="container items-center px-8 py-20">
				<div class="grid justify-center grid-cols-1 gap-2 my-10 place-items-center sm:grid-cols-2">
					<div>
						<img src="img/script.svg" class="flex-shrink-0 " width="450" alt="Responsive Icon">
					</div>
					<div>
						<h1 class="my-4 text-4xl font-normal leading-relaxed text-center text-gray-200 font-display">
							Scripts
						</h1>
						<h2 class="my-4 text-2xl font-semibold leading-snug text-center text-gray-200 ">Here are some snippets of
							code that I use or have used in past.
						</h2>
					</div>
				</div>
			</div>
		</div>
		<section>
			<svg version="1.1" viewbox="0 0 262.91 20.368" xmlns="http://www.w3.org/2000/svg">
				<g transform="translate(-36.792 -168.07)">
					<path
						d="m36.792 168.07s11.021 10.519 17.844 13.559c11.053 4.9255 23.559 6.704 35.66 6.8066 22.263 0.1887 43.546-11.584 65.809-11.409 14.389 0.11306 28.029 8.4322 42.413 8.0412 17.905-0.48677 38.599-11.462 52.171-12.863 13.572-1.401 18.315 7.1468 28.112 1.0125s16.753 3.4234 20.876-0.0289l0.0247-5.1191z"
						fill="#2c7a7b" fill-rule="evenodd" />
				</g>
			</svg>
		</section>
		<!-- hero end -->
		<!-- content start -->
		<div id="content-wrapper"
			class="container h-auto min-h-full px-8 py-20 my-8 leading-relaxed text-left bg-white shadow-md">
			<h3 class="mx-3 my-3 text-4xl font-bold text-center">Scripts</h3>
			<div class="space-y-5 ">
				<div class="my-4 text-2xl font-semibold"><span class="border-b-4 border-green-600 ">Daily backup of
						important locations</span></div>
				<p>This script backs up important locations, Keepass database etc, takes care of old backups and uses encryption
					for all the backups.</p>
				<p>It script uses tarfile module for compressing, shutil module for copying files, subprocess module
					to run shell commands to encrypt the backup using gpg, logging module to write logs at every action
					and arrow module to manipulate with date, time. Backups older than 7 days are automatically removed
					at the end. My weekly and monthly backup scripts use the same logic. These scripts are called in
					background using cron, no intervention is necessary.</p>
			</div>
			<!-- code snippet start -->
			<div class="my-10 md:mx-20">
				<p class="p-3 font-semibold text-white bg-gray-700 rounded rounded-b-none">Python Script</p>
				<div class="pl-4 overflow-y-scroll font-mono text-sm bg-gray-800 rounded rounded-t-none "
					style="max-height: 50vh;">
					<pre>
						<code class="language-python">
#! /usr/bin/python

import os
import tarfile
import shutil
import subprocess
import logging
import logging.handlers
from pathlib import Path
import arrow


logger = logging.getLogger(&quot;mybackup&quot;)
logger.setLevel(logging.DEBUG)
hdlr = logging.handlers.RotatingFileHandler(
		&quot;&lt;path&gt;/backup.log&quot;, maxBytes=200000, backupCount=5
)

formatter = logging.Formatter(
		&quot;%(asctime)s - %(levelname)s - Daily - %(message)s&quot;,
		datefmt=&quot;%m/%d/%Y - %I:%M:%S %p&quot;,
)
hdlr.setFormatter(formatter)
logger.addHandler(hdlr)

stmp = arrow.now().format(&quot;YYYYMMDD&quot;)

###########################################################
# Functions
###########################################################


def exclude_function(tarinfo):
		filename = tarinfo.name
		return (
				None
				if filename in exclude_files or os.path.splitext(filename)[1] in exclude_files
				else tarinfo
		)


def compress():
		if os.path.isfile(myfile + &quot;.zst&quot; + &quot;.gpg&quot;):
				logger.info(
						&quot;Encrypted backup already exists, skipping - %s&quot; % str(myfile + &quot;.zst&quot; + &quot;.gpg&quot;)
				)
		else:
				with tarfile.open(myfile, &quot;a:&quot;) as tar:
						for name in L:
								tar.add(name, filter=exclude_function)
						logger.info(&quot;Creating archive: %s completed&quot; % myfile)
						subprocess.call([
								&quot;zstd&quot;,
								myfile,
						])


def encrypt():
		if os.path.isfile(myfile + &quot;.zst&quot; + &quot;.gpg&quot;):
				logger.info(
						&quot;Encrypted backup already exists, skipping - %s&quot; % str(myfile + &quot;.zst&quot; + &quot;.gpg&quot;)
				)
		else:
				subprocess.call([&quot;gpg2&quot;, &quot;-es&quot;, &quot;-r&quot;, &quot;&lt;user&gt;&quot;, myfile + &quot;.zst&quot;])
				logger.info(&quot;Encrypting backup: %s completed&quot; % str(myfile + &quot;.zst&quot; + &quot;.gpg&quot;))


def cleanup(myfile):
		if os.path.isfile(myfile):
				os.remove(myfile)
				logger.info(&quot;Deleting: %s Done!&quot; % myfile)
		if os.path.isfile(myfile + &quot;.zst&quot;):
				os.remove(myfile + &quot;.zst&quot;)
				logger.info(&quot;Deleting: %s Done!&quot; % str(myfile + &quot;.zst&quot;))


###########################################################
# Backup Daily
###########################################################

path1 = &quot;&lt;path&gt;&quot;
path2 = &quot;&lt;path&gt;&quot;
path3 = &quot;&lt;path&gt;&quot;
backup_path = &quot;&lt;backup_path&gt;&quot;
backup_name = &quot;--daily&quot;

L = [path1, path2, path3]
exclude_files = [&quot;.tmp&quot;, &quot;.temp&quot;, &quot;.log&quot;, &quot;.dmp&quot;]
myfile = str(backup_path + stmp + backup_name + &quot;.tar&quot;)

source = &quot;&lt;source&gt;&quot;


def files(path):
		for file in os.listdir(path):
				if os.path.isfile(os.path.join(path, file)):
						yield file


for file in files(source):
		I = source + file
		L.append(I)

try:
		compress()
except Exception:
		logger.exception(&quot;Fatal error in compression process&quot;)

try:
		encrypt()
except Exception:
		logger.exception(&quot;Fatal error in encryption process&quot;)

try:
		cleanup(myfile)
except Exception:
		logger.exception(&quot;Fatal error in removal process&quot;)


#############################
# KeePass
#############################

new_keepass = stmp + &quot;--&lt;db&gt;&quot; + &quot;.kdbx&quot;
shutil.copy2(
		&quot;&lt;db_path&gt;&quot;,
		&quot;&lt;sync_path&gt;&quot; % new_keepass,
)
kee_path = &quot;&lt;path&gt;&quot;

myfile = kee_path + new_keepass

try:
		subprocess.call([&quot;gpg2&quot;, &quot;-es&quot;, &quot;-r&quot;, &quot;&lt;user&gt;&quot;, myfile])
		logger.info(&quot;Encrypting backup: %s completed&quot; % str(myfile + &quot;.gpg&quot;))
		os.remove(myfile)
except Exception:
		logger.exception(&quot;Fatal error in encryption process&quot;)


criticalTime = arrow.now().shift(days=-30).format(&quot;YYYYMMDD&quot;)
myfile = kee_path + criticalTime + &quot;--&lt;db&gt;&quot; + &quot;.kdbx&quot; + &quot;.gpg&quot;

try:
		cleanup(myfile)
		logger.info(&quot;Deleting - %s&quot; % myfile)
except Exception:
		logger.exception(&quot;Error deleting file.&quot;)

subprocess.call(
		[
				&quot;notify-send&quot;,
				&quot;Backup&quot;,
				&quot;Finished backing up keepass database and textfiles&quot;,
				&quot;--icon= &lt;path&gt;/backup.png&quot;,
		]
)

###########################################################
# Backup Firefox
###########################################################

path1 = &quot;&lt;path&gt;&quot;
backup_name = &quot;--firefox-profile&quot;

L = [path1]
exclude_files = [
		&quot;.tmp&quot;,
		&quot;.temp&quot;,
		&quot;.log&quot;,
		&quot;.dmp&quot;,
		&quot;&lt;path&gt;&quot;,
]
myfile = str(backup_path + stmp + backup_name + &quot;.tar&quot;)

try:
		compress()
except Exception:
		logger.exception(&quot;Fatal error in compression process&quot;)

try:
		encrypt()
except Exception:
		logger.exception(&quot;Fatal error in encryption process&quot;)

try:
		cleanup(myfile)
except Exception:
		logger.exception(&quot;Fatal error in removal process&quot;)
subprocess.call(
		[
				&quot;notify-send&quot;,
				&quot;Backup&quot;,
				&quot;Finished backing up firefox profile&quot;,
				&quot;--icon= &lt;path&gt;/backup.png&quot;,
		]
)

###########################################################
# Backup Important Data
###########################################################

path1 = &quot;&lt;path&gt;&quot;
backup_name = &quot;--important&quot;

L = [path1]
exclude_files = [
		&quot;.tmp&quot;,
		&quot;.temp&quot;,
		&quot;.log&quot;,
		&quot;.dmp&quot;,
]
myfile = str(backup_path + stmp + backup_name + &quot;.tar&quot;)

shutil.rmtree(&quot;&lt;path&gt;&quot;)
shutil.rmtree(&quot;&lt;path&gt;&quot;)
shutil.copytree(&quot;&lt;path&gt;&quot;, &quot;&lt;path&gt;&quot;)
shutil.copytree(&quot;&lt;path&gt;&quot;, &quot;&lt;path&gt;&quot;)
shutil.copytree(&quot;&lt;path&gt;&quot;, &quot;&lt;path&gt;&quot;)
shutil.copy2(&quot;&lt;path&gt;&quot;, &quot;&lt;path&gt;&quot;)
shutil.copy2(&quot;&lt;path&gt;&quot;, &quot;&lt;path&gt;&quot;)
shutil.copy2(&quot;&lt;path&gt;&quot;, &quot;&lt;path&gt;&quot;)

try:
		compress()
except Exception:
		logger.exception(&quot;Fatal error in compression process&quot;)

try:
		encrypt()
except Exception:
		logger.exception(&quot;Fatal error in encryption process&quot;)

try:
		cleanup(myfile)
except Exception:
		logger.exception(&quot;Fatal error in removal process&quot;)
subprocess.call(
		[
				&quot;notify-send&quot;,
				&quot;Backup&quot;,
				&quot;Finished backing up important stuff from Data&quot;,
				&quot;--icon= &lt;path&gt;/backup.png&quot;,
		]
)

#############################
# Mega files
#############################

my_dir = &quot;&lt;path&gt;&quot;
for item in Path(my_dir).glob(&quot;*.gpg&quot;):
		if item.is_file():
				d = str(item.absolute())
				os.remove(d)
				logger.info(&quot;Deleting old backups in Mega: %s Done!&quot; % d)

my_dir2 = &quot;&lt;path&gt;&quot;
os.chdir(my_dir2)
files = sorted(os.listdir(os.getcwd()), key=os.path.getmtime)

oldest = files[0]
new1 = files[-1]
new2 = files[-2]
new3 = files[-3]
shutil.copy2((new1), my_dir)
shutil.copy2((new2), my_dir)
shutil.copy2((new3), my_dir)
logger.info(&quot;Copied new files to Mega: %s, %s and %s Done!&quot; % (new1, new2, new3))


#############################
# Cleanup of old backup
#############################

criticalTime = arrow.now().shift(hours=+5).shift(days=-7)

for item in Path(backup_path).glob(&quot;*&quot;):
		if item.is_file():
				itemTime = arrow.get(item.stat().st_mtime)
				if itemTime &lt; criticalTime:
						# remove it
						d = str(item.absolute())
						os.remove(d)
						logger.info(&quot;Deleting: %s Done!&quot; % d)
subprocess.call(
		[
				&quot;notify-send&quot;,
				&quot;Cleanup&quot;,
				&quot;Finished removing backups older than 7 days&quot;,
				&quot;--icon= &lt;path&gt;/cleanup.png&quot;,
		]
)
						</code>
					</pre>
				</div>
			</div>
			<!-- code snippet end -->
			<p class="my-4">
				Currently I am using a shell script instead of python. Generally works better.
			</p>
			<!-- code snippet start -->
			<div class="my-10 md:mx-20">
				<p class="p-3 font-semibold text-white bg-gray-700 rounded rounded-b-none">Shell Script</p>
				<div class="pl-4 overflow-y-scroll font-mono text-sm bg-gray-800 rounded rounded-t-none "
					style="max-height: 50vh;">

					<pre>
						<code class="language-bash">
#!/bin/zsh
SHELL=/bin/zsh
PATH=/sbin:/bin:/usr/sbin:/usr/bin

set -ex

# Replacing daily python script with this one since the tarfile cant use zst correctly yet. 

echo &quot;Execution time:&quot; $(date +%Y%m%d/%H:%M:%S)
echo &quot;-----------------------------&quot;

date=$(date +&quot;%Y%m%d&quot;)  

########################################
########       Daily stuff      ########
########################################

src=&quot;&lt;path&gt;&quot;
dest=&quot;&lt;path&gt;&quot;
myfile=&quot;$date--daily&quot;

function compress-daily(){
		if [ -e $dest/&quot;$myfile&quot;.tar.zst.gpg ];
		then 
				echo &quot;&quot;$myfile&quot;.gpg already exists.&quot;
				echo &quot;-----------------------------&quot;        
		else
				tar -cp -X $src/daily-exclude -T $src/daily-source &gt; $dest/&quot;$myfile&quot;.tar
				echo &quot;Tar file ready - &quot;$myfile&quot;.tar&quot;
				zstd -c -T0 -15 $dest/&quot;$myfile&quot;.tar -o $dest/&quot;$myfile&quot;.tar.zst &amp;&amp; mv $dest/&quot;$myfile&quot;.tar /var/tmp
				echo &quot;Zstandard compression applied, tar file removed.&quot;
				gpg2 -es -r akshay $dest/&quot;$myfile&quot;.tar.zst &amp;&amp; mv $dest/&quot;$myfile&quot;.tar.zst /var/tmp
				echo &quot;Archive encrypted, daily backup done.&quot;
				echo &quot;-----------------------------&quot;        
		fi
}
compress-daily


########################################
########        Firefox       ##########
########################################

src=&quot;&lt;path&gt;&quot;
dest=&quot;&lt;path&gt;&quot;
myfile=&quot;$date--firefox-profile&quot;

function compress-firefox(){
		if [ -e $dest/&quot;$myfile&quot;.tar.zst.gpg ];
		then 
				echo &quot;&quot;$myfile&quot;.gpg already exists.&quot;
				echo &quot;-----------------------------&quot;        
		else
				cp -r -p &lt;path&gt; &lt;path&gt;
				tar -cp -X $src/firefox-exclude /home/akya/mozilla &gt; $dest/&quot;$myfile&quot;.tar
				rm -r /home/akya/mozilla
				echo &quot;Tar file ready - &quot;$myfile&quot;.tar&quot;
				zstd -c -T0 --ultra -20 $dest/&quot;$myfile&quot;.tar -o $dest/&quot;$myfile&quot;.tar.zst &amp;&amp; mv $dest/&quot;$myfile&quot;.tar /var/tmp
				echo &quot;Zstandard compression applied, tar file removed.&quot;
				gpg2 -es -r akshay $dest/&quot;$myfile&quot;.tar.zst &amp;&amp; mv $dest/&quot;$myfile&quot;.tar.zst /var/tmp
				echo &quot;Archive encrypted, firefox profile backed up.&quot;
				echo &quot;-----------------------------&quot;        
		fi
}
compress-firefox

########################################
#########      Keepass DB      #########
########################################

src=&quot;&lt;path&gt;&quot;
dest=&quot;&lt;path&gt;&quot;
myfile=&quot;$date--root.kdbx&quot;

function keepass-database(){
		if [ -e $dest/&quot;$myfile&quot;.gpg ];
		then
				echo &quot;&quot;$myfile&quot;.gpg already exists.&quot;
				echo &quot;-----------------------------&quot;        
		else
				gpg2 -es -r akshay -o $dest/&quot;$myfile&quot;.gpg $src/root.kdbx 
				echo &quot;root.kdbx backed up in mega.&quot;
				echo &quot;-----------------------------&quot;        
		fi
}
keepass-database

########################################
#########    Keepass Cleanup     #######
########################################

# Keep latest 30 files in Mega keepass sync folder
cd &lt;path&gt;
ls -tp | grep -v &#39;/$&#39; | tail -n +31 | xargs -d &#39;\n&#39; -r rm --
echo &quot;Older keepass backups removed.&quot;
echo &quot;-----------------------------&quot;

########################################
##########    Important stuff   ########
########################################

cd &lt;path&gt;
src=&quot;&lt;path&gt;&quot;
dest=&quot;&lt;path&gt;&quot;
myfile=&quot;$date--important&quot;


function important-stuff(){
		if [ -d ./code ] &amp;&amp; [ -d ./notes ];
		then   
				echo &quot;Directories exist, they will be removed.&quot; 
				rm -r &lt;path&gt; &lt;path&gt; &lt;path&gt; &lt;path&gt; 
				echo &quot;-----------------------------&quot;
		else
				echo &quot;Directories do not exist. They will be created.&quot;
				echo &quot;-----------------------------&quot;        
		fi
}
important-stuff

cp -r -p &lt;path&gt; &lt;path&gt;
cp -r -p &lt;path&gt; &lt;path&gt;
cp -r -p &lt;path&gt; &lt;path&gt;
cp -r -p &lt;path&gt; &lt;path&gt;
cp -p &lt;path&gt; &lt;path&gt;
cp -p &lt;path&gt; &lt;path&gt;
cp -p &lt;path&gt; &lt;path&gt;

function compress-important(){
		if [ -e $dest/&quot;$myfile&quot;.tar.zst.gpg ];
		then 
				echo &quot;&quot;$myfile&quot;.gpg already exists.&quot;
				echo &quot;-----------------------------&quot;
		else
				tar -cp &lt;path&gt; &gt; $dest/&quot;$myfile&quot;.tar
				echo &quot;Tar file ready - &quot;$myfile&quot;.tar&quot;
				zstd -c -T0 -15 $dest/&quot;$myfile&quot;.tar -o $dest/&quot;$myfile&quot;.tar.zst &amp;&amp; mv $dest/&quot;$myfile&quot;.tar /var/tmp
				echo &quot;Zstandard compression applied, tar file removed.&quot;
				gpg2 -es -r akshay $dest/&quot;$myfile&quot;.tar.zst &amp;&amp; mv $dest/&quot;$myfile&quot;.tar.zst /var/tmp
				echo &quot;Archive encrypted, important stuff backed up.&quot;
				echo &quot;-----------------------------&quot;        
		fi
}
compress-important



########################################
########       Mega backup        ######
########################################
src=&quot;&lt;path&gt;&quot;
dest=&quot;&lt;path&gt;&quot;

# Removing older backups from Mega sync folder

cd $dest
ls -tp | grep -v &#39;/$&#39; | xargs -d &#39;\n&#39; -r rm --
echo &quot;Removed old backups from Mega sync folder&quot;
echo &quot;-----------------------------&quot;

cd $src
# Removing older backups from backup-daily on External HDD
ls -tp | grep -v &#39;/$&#39; | tail -n +22 | xargs -d &#39;\n&#39; -r rm --
echo &quot;Removed old backups from backup-daily on External HDD, Kept latest 21 (3 each for 1 week)&quot;
echo &quot;-----------------------------&quot;

# Copying latest backups to Mega sync folder
ls -tpr | grep -v &#39;/$&#39; | tail -n -3 | xargs -d &#39;\n&#39; -r cp -t &quot;$dest&quot;
echo &quot;Copied all latest backups (3 for current day) to mega sync.&quot;
echo &quot;-----------------------------&quot;
												</code>
					</pre>
				</div>
			</div>
			<!-- code snippet end -->
			<div class="my-4 text-2xl font-semibold"><span class="border-b-4 border-pink-600 ">Using rsync to
					copy
					data to external media</span></div>
			<!-- code snippet start -->
			<div class="my-10 md:mx-20">
				<p class="p-3 font-semibold text-white bg-gray-700 rounded rounded-b-none">Shell Script</p>
				<div class="pl-4 overflow-y-scroll font-mono text-sm bg-gray-800 rounded rounded-t-none "
					style="max-height: 50vh;">

					<pre>
						<code class="language-bash">
#!/bin/zsh
PATH=/sbin:/bin:/usr/sbin:/usr/bin

set -ex

########################################
########         audio          ########
########################################

echo "1] Syncing: audio"
echo "-----------------------------"
# rsync -ahv --delete --progress --log-file=/home/akya/.anacron/logs/rsync-ext.log /media/entmt/audio/ /run/media/akya/dump/audio/
rsync -ahv --stats --delete --progress /media/entmt/audio/ /run/media/akya/dump/audio/ | sed '0,/^$/d' &gt;&gt; /home/akya/.anacron/logs/rsync-ext.log

########################################
########       software       ##########
########################################

echo "2] Syncing: software"
echo "-----------------------------"
rsync -ahv --stats --delete --progress /media/data/software/ /run/media/akya/backup/data/software/ | sed '0,/^$/d' &gt;&gt; /home/akya/.anacron/logs/rsync-ext.log

########################################
#########       concerts       #########
########################################

echo "3] Syncing: concerts"
echo "-----------------------------"
rsync -ahv --stats --delete --progress /media/entmt/video/concerts/ /run/media/akya/backup/concerts/ | sed '0,/^$/d' &gt;&gt; /home/akya/.anacron/logs/rsync-ext.log

########################################
#########         comedy      ##########
########################################

echo "4] Syncing: comedy"
echo "-----------------------------"
rsync -ahv --stats --delete --progress /media/entmt/video/comedy/ /run/media/akya/dump/video/comedy/ | sed '0,/^$/d' &gt;&gt; /home/akya/.anacron/logs/rsync-ext.log
						</code>

				</pre>

				</div>
			</div>
			<!-- code snippet end -->

			<!-- Disqus comment box start -->
			<div class="mt-40 mb-20">
				<div id="disqus_thread"></div>
				<script>
					(function () { // DON'T EDIT BELOW THIS LINE
						var d = document,
							s = d.createElement('script');
						s.src = 'https://web-o-reviews.disqus.com/embed.js';
						s.setAttribute('data-timestamp', +new Date());
						(d.head || d.body).appendChild(s);
					})();
				</script>
				<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments
						powered by Disqus.</a></noscript>
			</div>
			<!-- Disqus comment box end -->
		</div>
	</main>
	<!-- content end -->
	<!-- Footer wave start -->
	<section>
		<svg class="mt-20" version="1.1" viewbox="0 0 1920 251.44" xmlns="http://www.w3.org/2000/svg">
			<g transform="translate(768.02)">
				<path class="fill-current text-secondary "
					d="m1152 250h-1920v-250s126.71 78.536 349.98 80.05c177.85 1.203 362.81-63.874 553.8-63.874 290.52 0 383.46 57.712 603.99 61.408 220.53 3.696 278.06-61.408 412.23-17.239"
					fill="#ff7d66" />
				<path class="fill-current text-secondary-lighter"
					d="m1152 144s-467.92 116.86-1027.2-17.294c-522.77-125.38-892.76-81.128-892.76-81.128v204.42h1920z"
					fill="#ff9b8a" />
				<path class="text-gray-100 fill-current"
					d="m-768.02 196.99s208.55-75.581 701.33-20.768c376.71 41.908 520.83-67.962 722.54-67.962 222.93 0 311.6 87.808 496.18 90.679v52.498h-1920z"
					fill="#f7fafc" />
			</g>
		</svg>
	</section>
	<!-- Footer wave end -->
	<!-- footer start -->
	<footer class="h-auto min-h-full py-10 overflow-hidden bg-gray-100 ">
		<div
			class="flex flex-col items-center justify-between max-w-6xl mx-auto my-12 sm:flex-row sm:items-end sm:px-6 lg:px-8 ">
			<div class="flex flex-row">
				<div class="w-40 space-y-3 md:space-y-0">
					<div class="mb-4 font-semibold text-center uppercase ">Information
					</div>
					<div class="grid grid-cols-6 leading-relaxed divide-x divide-gray-500">
						<div class="col-span-2 ml-5"><svg class="w-5 h-5 mt-1" xmlns="http://www.w3.org/2000/svg" fill="none"
								viewbox="0 0 24 24" stroke="currentColor">
								<title>License</title>
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
							</svg></div>
						<div class="col-span-4 "><a
								class="mx-4 text-teal-700 transition duration-150 ease-in-out hover:text-gray-900"
								href="license.html">License</a>
						</div>
					</div>
					<div class="grid grid-cols-6 leading-relaxed divide-x divide-gray-500">
						<div class="col-span-2 ml-5"><svg class="w-5 h-5 mt-1" xmlns="http://www.w3.org/2000/svg" fill="none"
								viewbox="0 0 24 24" stroke="currentColor">
								<title>Archive</title>
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
							</svg></div>
						<div class="col-span-4"><a
								class="mx-4 text-teal-700 transition duration-150 ease-in-out hover:text-gray-900"
								href="archive.html">Archive</a>
						</div>
					</div>
					<div class="grid grid-cols-6 leading-relaxed divide-x divide-gray-500">
						<div class="col-span-2 ml-5"><svg class="w-5 h-5 mt-1" xmlns="http://www.w3.org/2000/svg"
								viewbox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
								stroke-linejoin="round">
								<title>Github</title>
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<path
									d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
							</svg></div>
						<div class="col-span-4"><a
								class="mx-4 text-teal-700 transition duration-150 ease-in-out hover:text-gray-900"
								href="https://github.com/akyag" target="_blank" rel="noopener">Github</a>
						</div>
					</div>
				</div>
				<div class="w-40 space-y-3 md:space-y-0">
					<div class="mb-4 font-semibold text-center uppercase ">Find me on
					</div>
					<div class="grid grid-cols-6 leading-relaxed divide-x divide-gray-500">
						<div class="col-span-2 ml-5"><svg class="w-5 h-5 mt-1" xmlns="http://www.w3.org/2000/svg"
								viewbox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
								stroke-linejoin="round">
								<title>LinkedIn</title>
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<rect x="4" y="4" width="16" height="16" rx="2" />
								<line x1="8" y1="11" x2="8" y2="16" />
								<line x1="8" y1="8" x2="8" y2="8.01" />
								<line x1="12" y1="16" x2="12" y2="11" />
								<path d="M16 16v-3a2 2 0 0 0 -4 0" />
							</svg></div>
						<div class="col-span-4"><a
								class="mx-4 text-teal-700 transition duration-150 ease-in-out hover:text-gray-900"
								href="https://www.linkedin.com/in/akshayghate/" target="_blank" rel="noopener">LinkedIn</a>
						</div>
					</div>
					<div class="grid grid-cols-6 leading-relaxed divide-x divide-gray-500">
						<div class="col-span-2 ml-5"><svg class="w-5 h-5 mt-1" xmlns="http://www.w3.org/2000/svg"
								viewbox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
								stroke-linejoin="round">
								<title>Twitter</title>
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<path
									d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
							</svg></div>
						<div class="col-span-4"><a
								class="mx-4 text-teal-700 transition duration-150 ease-in-out hover:text-gray-900"
								href="https://twitter.com/akshayg" target="_blank" rel="noopener">Twitter</a>
						</div>
					</div>
					<div class="grid grid-cols-6 leading-relaxed divide-x divide-gray-500">
						<div class="col-span-2 ml-5"><svg class="w-5 h-5 mt-1" xmlns="http://www.w3.org/2000/svg"
								viewbox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
								stroke-linejoin="round">
								<title>Facebook</title>
								<path stroke="none" d="M0 0h24v24H0z" fill="none" />
								<path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3" />
							</svg></div>
						<div class="col-span-4"><a
								class="mx-4 text-teal-700 transition duration-150 ease-in-out hover:text-gray-900"
								href="https://www.facebook.com/Web.o.Reviews" target="_blank" rel="noopener">Facebook</a>
						</div>
					</div>
				</div>
			</div>
			<div class="flex flex-col items-center mt-6 sm:m-0 md:mr-20">
				<div><a href="index.html"><img src="img/logo-transparent.svg" width="230" alt="Web-o-Reviews"></a></div>
				<div class="grid grid-cols-1 divide-y-2 divide-gray-500 lg:grid-cols-2 lg:divide-y-0 lg:divide-x-2">
					<div><svg class="inline-block w-5 h-5 mx-1 mb-1 " xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"
							stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
							<title>Copyright</title>
							<path stroke="none" d="M0 0h24v24H0z" fill="none" />
							<circle cx="12" cy="12" r="9" />
							<path d="M14.5 9a3.5 4 0 1 0 0 6" />
						</svg>2009-2020 - weboreviews.com</div>
					<div class="lg:pl-4">Designed with <svg class="inline-block w-5 h-5 text-red-600 "
							xmlns="http://www.w3.org/2000/svg" viewbox="0 0 20 20" fill="currentColor">
							<title>Heart</title>
							<path fill-rule="evenodd"
								d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"
								clip-rule="evenodd" />
						</svg> by Akshay Ghate.</div>
				</div>
			</div>
		</div>
	</footer>
	<!-- footer end -->
	<!-- scroll to top start -->
	<div
		class="fixed bottom-0 right-0 block w-10 h-10 px-2 py-2 mb-8 mr-8 text-gray-100 transition-all duration-700 transform translate-x-24 bg-teal-500 rounded-full hover:bg-teal-400 vanillatop">
		<a href="#!" aria-label="Scroll to top"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24"
				stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
			</svg></a></div>
	<!-- scroll to top end -->
	<!-- scripts -->
	<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.7.2/dist/alpine.min.js" defer></script>
	<script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/components/prism-core.min.js" defer></script>
	<script src="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
	<script src="js/vanillatop.js" defer></script>

</body>

</html>